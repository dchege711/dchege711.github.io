<!DOCTYPE html>
<html>

    <head>
        <title>
             
                2020 Tokyo Olympics Ranking | c13u
            
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" type="text/css" href="/css/main.css" />
        <link rel="stylesheet" type="text/css" href="/css/all_font_awesome_v5.9.min.css" />
        
        <link rel="shortcut icon" href="/img/favicon_io/favicon.ico">
        <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon_io/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon_io/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon_io/favicon-16x16.png">

        <link rel="stylesheet" href="/css/vs.css">
        <script type="text/javascript" src="/js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script type="text/javascript" async
            src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>

        <script type="text/javascript" src="/js/d3/d3.min.js"></script>
        <script type="text/javascript" src="/js/PlotUtils.js"></script>
        <script type="text/javascript" src="/js/OrganizeCitations.js"></script>
        <script type="text/javascript" src="/js/HighlightAnchor.js"></script>

        
        
    </head>

    <body>

        <div class="container" id="main_div">

            
            <form action="/search" method="get" id="globalSearchForm">
                <input type="text" id="q" name="q">
                <input type="submit" id="submitButton" value="Search">
            </form>
            
            
            
            <nav aria-label="Breadcrumb" class="breadcrumb">
    <ul>
        





<li>
  <a href="https://www.curiosities.dev/">Home</a>
</li>


<li>
  <a href="https://www.curiosities.dev/sports/">Sports</a>
</li>


<li class="active">
  <a href="https://www.curiosities.dev/sports/2021-08-06-2020-olympics-ranking/">2020 Tokyo Olympics Ranking</a>
</li>

    </ul>
</nav>


            
            
<section>
    <header>
    <h1> 2020 Tokyo Olympics Ranking</h1>
    <p class="meta">
        
        Dated Aug 6, 2021; 
        
        last modified on Fri, 06 Aug 2021
        
    </p>
    </header>

    <div id="toc-then-article">
        <aside id="toc">
            
        </aside>

        <article id="main-article">
            
<small>
    <p>Medal count last updated at <span id="lastMedalStandingsFetch"></span></p>.
</small>
<table>
    <thead>
        <tr>
            <th>Rank</th>
            <th title="Difference between the rank from 'Weighted Sum' and from 'Weighted Sum Per Athlete'">\(\Delta\)</th>
            <th title="Team/National Olympic Committee">Team/NOC</th>
            <th>Gold</th>
            <th>Silver</th>
            <th>Bronze</th>
            <th title="3g + 2s + b">Weighted Sum</th>
            <th title="(3g + 2s + b) / (num_atheletes_sent_to_olympics)">
                Weighted Sum Per Athlete
            </th>
        </tr>
    </thead>
    <tbody id="standingsTBody">
    </tbody>
</table>

<script>
    const tableBodyElem = document.getElementById("standingsTBody");
    const lastMedalFetchElem = document.getElementById("lastMedalStandingsFetch");

    function updateLastMedalFetchTime(pathToStandingsCSV) {
        // e.g. 2020-tokyo-olympics-2021-08-06-10-07+0000.csv
        const pstTimeRegex = /2020-tokyo-olympics-(\d{4})-(\d{2})-(\d{2})-(\d{2})-(\d{2})(\+\d{4}).csv/;

        // [ "2020-tokyo-olympics-2021-08-06-10-07.csv", "2021", "08", "06", "10", "07", "+0000" ]
        const matches = pstTimeRegex.exec(pathToStandingsCSV);

        const year = matches[1], month = matches[2], day = matches[3], hr = matches[4], min = matches[5], utcOffset = matches[6];
        let parsedDate = new Date(`${year}-${month}-${day}T${hr}:${min}${utcOffset}`);
        lastMedalFetchElem.innerText = parsedDate.toLocaleString();
    }

    async function loadMedalStandings() {
        const pathToStandingsCSV = await d3.text("/text/updated_2020_olympics.txt");
        let standingsData = await d3.csv(`/text/${pathToStandingsCSV}`, (d) => {
            const numAthletes = Number(d.num_athletes);
            const numGold =  Number(d.num_gold);
            const numSilver = Number(d.num_silver);
            const numBronze = Number(d.num_bronze);
            const weightedSum = 3 * numGold + 2 * numSilver + numBronze;

            return {
                nocCode: d.noc_code,
                nocName: d.noc_name,
                numAthletes: numAthletes,
                numGold: numGold,
                numSilver: numSilver,
                numBronze: numBronze,
                weightedSum: weightedSum,
                weightedSumPerAthlete: numAthletes <= 0 ? 0 : weightedSum / numAthletes,
            }
        });
        let nonParticipatingNOCs = new Set([]);
        let participatingNOCsWithNoMedals = new Set([]);
        standingsData = standingsData.filter((d) => {
            if (d.numAthletes <= 0 || d.weightedSum === 0) {
                return false;
            }

            return true;
        });

        function populateRanking(data, rankingAttribute, rankingKey) {
            let rank = 0;
            data.forEach((d, idx) => {
                if (idx === 0 || data[idx - 1][rankingAttribute] != d[rankingAttribute]) {
                    rank = idx + 1;
                }
                d[rankingKey] = rank;
            });
        }

        let rankingsStr = ``;
        standingsData.sort(weightedSumComparator);
        populateRanking(standingsData, "weightedSum", "weightedSumRank");

        standingsData.sort(weightedSumPerAthleteComparator);
        populateRanking(standingsData, "weightedSumPerAthlete", "weightedSumPerAthleteRank");

        function getDeltaString(delta) {
            if (delta > 0) {
                return `<span style="color:rgb(2, 187, 2);">&#9650; ${Math.abs(delta)}</span>`;
            } else if (delta < 0) {
                return `<span style="color:red;">&#9660; ${Math.abs(delta)}</span>`;
            } else {
                return "-";
            }
        }

        standingsData.forEach((d, idx) => {
            rankingsStr += `<tr>
                <td>${idx + 1}</td>
                <td title="Ranks ${d.weightedSumRank} by 'Weighted Sum'">${getDeltaString(d.weightedSumRank - d.weightedSumPerAthleteRank)}</td>
                <td>${d.nocName}</td>
                <td>${d.numGold}</td>
                <td>${d.numSilver}</td>
                <td>${d.numBronze}</td>
                <td title="(3 * ${d.numGold}) + (2 * ${d.numSilver}) + ${d.numBronze}">
                    ${d.weightedSum}
                </td>
                <td title="${d.weightedSum} / ${d.numAthletes}">
                    ${d.weightedSumPerAthlete.toFixed(4)}
                </td>
            </tr>`;
        })

        updateLastMedalFetchTime(pathToStandingsCSV);
        tableBodyElem.innerHTML = rankingsStr;
    }

    function standingsComparator(a, b, key) {
        if (a[key] > b[key]) {
            return -1;
        } else if (a[key] < b[key]) {
            return 1;
        } else {
            return 0;
        }
    }

    function weightedSumComparator(a, b) {
        return standingsComparator(a, b, "weightedSum");
    }

    function weightedSumPerAthleteComparator(a, b) {
        return standingsComparator(a, b, "weightedSumPerAthlete");
    }

    loadMedalStandings();
</script>

        </article>

        




    </div>
    <footer>
        
        
        
            
        

        
        

    </footer>
</section>


        </div>

        <footer>
            <a href="mailto:d.chege711@gmail.com">Email</a>
            
            <a href="/about">About</a>
            <a href="/search">Search</a>
        </footer>

    </body>

</html>
