<!doctype html><html lang=en><head><title>C# Performance Tools | curiosities.dev</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo (https://gohugo.io/)"><meta name=description content="BenchmarkDotNet Some work projects use BenchmarkDotNet as the .NET library for benchmarking. Getting familiar with it should pay dividends. 
To run the benchmarks in the Day13ClawContraption class:
dotnet run -c Release -- -f '*Day13ClawContraption*' A job describes how to run your benchmark, e.g, ID, environment, run settings. BenchmarkDotNet has a smart algorithm for choosing values like IterationCount, so you typically don&rsquo;t need to specify those.  Sample measurements for the default job:..."><meta property="og:title" content="C# Performance Tools"><meta property="og:description" content="BenchmarkDotNet Some work projects use BenchmarkDotNet as the .NET library for benchmarking. Getting familiar with it should pay dividends. 
To run the benchmarks in the Day13ClawContraption class:
dotnet run -c Release -- -f '*Day13ClawContraption*' A job describes how to run your benchmark, e.g, ID, environment, run settings. BenchmarkDotNet has a smart algorithm for choosing values like IterationCount, so you typically don&rsquo;t need to specify those.  Sample measurements for the default job:..."><meta property="og:type" content="website"><meta property="og:url" content="https://www.curiosities.dev/computer-science/programming-challenges/advent-of-code/2024/AoC2024.Benchmarks/readme/"><meta property="og:site_name" content="curiosities.dev"><link rel=stylesheet type=text/css href=/css/main.min.css><link rel=preload href=/css/all_font_awesome_v5.9.min.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/all_font_awesome_v5.9.min.min.css></noscript><link rel="shortcut icon" href=/img/favicon_io/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/img/favicon_io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon_io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon_io/favicon-16x16.png><script async type=text/javascript src=/js/OrganizeCitations.min.js></script><script async type=text/javascript src=/js/HighlightAnchor.min.js></script><script async type=text/javascript src=/js/SummaryPageUtils.min.js></script><link rel=preload href=/css/vs.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/vs.min.css></noscript><script defer type=text/javascript src=/js/highlight.min.min.js onload=addURLHighlighter();></script><script defer>const hjlsURLRegex=/https?:\/\/[^\s<]+/g
const hjlsCitationRegex=/&lt;span class=&quot;citation-ref&quot;&gt;&lt;a href=&quot;(.*)&quot;&gt;&lt;\/a&gt;&lt;\/span&gt;/g
function addURLHighlighter(){hljs.addPlugin({"after:highlight":(result)=>{result.value=result.value.replaceAll(hjlsURLRegex,"<a href='$&' target='_blank'>$&</a>");console.log(result.value);result.value=result.value.replaceAll(hjlsCitationRegex,"<span class='citation-ref'><a href='$1'></a></span>");}});hljs.highlightAll();}</script></head><body><div class=container id=main_div><form action=/search method=get id=globalSearchForm><input type=text id=q name=q title="Search Query">
<input type=submit id=submitButton value=Search></form><nav aria-label=Breadcrumb class=breadcrumb><ul><li><a href=https://www.curiosities.dev/>Home</a></li><li><a href=https://www.curiosities.dev/computer-science/>Computer Science & Software Engineering</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/>Programming Challenges</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/advent-of-code/>Advent of Code</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/advent-of-code/2024/>Advent of Code 2024 - C#</a></li><li class=active><a href=https://www.curiosities.dev/computer-science/programming-challenges/advent-of-code/2024/AoC2024.Benchmarks/readme/>C# Performance Tools</a></li></ul></nav><section><header><h1>C# Performance Tools</h1><p class=meta>Dated Jan 2, 2026;
last modified on Fri, 02 Jan 2026</p></header><div id=toc-then-article><aside id=toc><nav id=TableOfContents><ul><li><a href=#benchmarkdotnet>BenchmarkDotNet</a><ul><li><a href=#memory-diagnoser>Memory Diagnoser</a></li><li><a href=#perf-profiles>Perf Profiles</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></aside><article id=main-article><h2 id=benchmarkdotnet>BenchmarkDotNet</h2><p>Some work projects use <code>BenchmarkDotNet</code> as the .NET library for benchmarking.
Getting familiar with it should pay dividends. <span class=citation-ref><a href=#BenchmarkDotNet></a></span></p><p>To run the benchmarks in the <code>Day13ClawContraption</code> class:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>dotnet run -c Release -- -f <span style=color:#d88200>&#39;*Day13ClawContraption*&#39;</span>
</code></pre></div><p>A <code>job</code> describes how to run your benchmark, e.g, ID, environment, run settings.
<code>BenchmarkDotNet</code> has a smart algorithm for choosing values like
<code>IterationCount</code>, so you typically don&rsquo;t need to specify those. <span class=citation-ref><a href=#JobsBenchmarkDotNet></a></span>Sample measurements for the default job:</p><table><thead><tr><th>Method</th><th>Mean</th><th>Error</th><th>StdDev</th></tr></thead><tbody><tr><td>Foo</td><td>3.845 s</td><td>0.0747 s</td><td>0.0800 s</td></tr></tbody></table><h3 id=memory-diagnoser>Memory Diagnoser</h3><p>The Common Language Runtime continually balances two priorities when it comes to
garbage collection (GC):</p><ul><li>Not letting an application&rsquo;s working set get too large by delaying GC</li><li>Not letting the GC run too frequently (during GC, all other managed threads
are suspended)</li></ul><p>The managed heap is divided into 3 generations, 0, 1, and 2, so it can handle
long-lived and short-lived objects separately:</p><ul><li><em>Generation 0</em>: The youngest and contains short-lived objects. New
objects are stored here, unless they&rsquo;re large in which case they go to the
large object heap (LOH / generation 3).</li><li><em>Generation 1</em>: After GC collects <code>Gen 0</code>, it compacts the memory for
the reachable objects and promotes them to <code>Gen 1</code>. Objects that survive
collections tend to have longer lifetimes, and so the promotion makes sense.
If a GC of <code>Gen 0</code> doesn&rsquo;t reclaim enough memory, then the GC can collect <code>Gen 1</code> and if need be, <code>Gen 2</code>, but in most cases, <code>Gen 0</code> collection is
sufficient. Objects in <code>Gen 1</code> that survive GC are promoted to <code>Gen 2</code>.</li><li><em>Generation 2</em>: Contains long-lived objects, e.g., static data in a
server application. Objects in <code>Gen 2</code> that survive GC remain in <code>Gen 2</code>.
Objects on the large object heap are also collected in <code>Gen 2</code>.</li></ul><p><span class=citation-ref><a href=#DotNetGCFundamentals></a></span></p><p><code>MemoryDiagnoser</code> allows measuring the number of allocated bytes and garbage
collection frequency, e.g.,</p><table><thead><tr><th>Method</th><th>Gen0</th><th>Gen1</th><th>Gen2</th><th>Allocated</th></tr></thead><tbody><tr><td>Foo</td><td>596</td><td>193</td><td>48</td><td>3.49 MB</td></tr></tbody></table><ul><li><em>Allocated</em> contains the size of allocated <em>managed</em> memory (not
<code>stackalloc</code> or native heap allocations). It&rsquo;s per single invocation,
<em>inclusive</em>.</li><li><em>Gen X</em> contains the number of <code>Gen X</code> collections scaled to per 1,000
operations, e.g., GC collects memory 596 times per 1,000 benchmark invocations
in generation 0.</li><li><code>-</code> and <code>0</code> are synonymous, e.g., <code>-</code> in <code>Gen X</code> means no garbage collection
was performed for generation <code>X</code>.</li></ul><p><span class=citation-ref><a href=#SitnikMemoryDiagnoser></a></span></p><h3 id=perf-profiles>Perf Profiles</h3><p><code>BenchmarkDotNet.Diagnostics.Windows</code> allows collecting ETL traces that show
where most of the time is spent. However, this package is only available on
Windows because it internally uses Event Tracing for Windows (ETW) to capture
stack traces and important .NET Runtime events. <span class=citation-ref><a href=#SitnikEtwProfiler></a></span></p><p><code>BenchmarkDotNet.Diagnostics.dotTrace</code> can also capture traces using the
<code>dotTrace</code> command-line profiler. However, <code>dotTrace</code> is not available for free;
JetBrains charges for it. <span class=citation-ref><a href=#BenchmarkDotNet.Diagnostics.dotTrace></a></span></p><p>Trying to use <code>dotnet-trace</code> as it&rsquo;s free. For some reason,</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>dotnet-trace collect --format speedscope -- dotnet run -c Release
</code></pre></div><p>&mldr; doesn&rsquo;t give me much. <code>-- &lt;command></code> has a disclaimer for commands that
launch multiple apps, but I don&rsquo;t think it applies here. Running
<code>dotnet run -c Release -- -f '*Day13ClawContraption*'</code> in one terminal and then:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>dotnet-trace collect --name <span style=color:#d88200>&#34;AoC2024.Benchmarks&#34;</span> --format speedscope --output advent-of-code/2024/AoC2024.Benchmarks/BenchmarkDotNet.Artifacts/perf-profile.nettrace
</code></pre></div><p>&mldr; in another seems like a step forward because <code>dotnet-trace</code> exits after the
benchmark exits. <span class=citation-ref><a href=#dotnet-trace></a></span></p><p>Still no dice though; seeing a lot <code>UNMANAGED_CODE_TIME</code> without any actionable
insights. Creating a separate program that benchmarks the code directly instead
of going through <code>BenchmarkDotNet</code> works! In hindsight, I think I was profiling
<code>BenchmarkSwitcher.FromAssembly(typeof(Program).Assembly).Run(args)</code> instead of
my user code. One more <code>.csproj</code> it is!</p><h2 id=references>References</h2><ol><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=BenchmarkDotNet>Home | BenchmarkDotNet<i>.</i></cite>
<a href=https://benchmarkdotnet.org/index.html target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=benchmarkdotnet.org" loading=lazy aria-hidden=true width=16 height=16>
<i>benchmarkdotnet.org</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jan 2, 2026.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=JobsBenchmarkDotNet>Jobs | BenchmarkDotNet<i>.</i></cite>
<a href=https://benchmarkdotnet.org/articles/configs/jobs.html target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=benchmarkdotnet.org" loading=lazy aria-hidden=true width=16 height=16>
<i>benchmarkdotnet.org</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jan 2, 2026.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=SitnikMemoryDiagnoser>The new MemoryDiagnoser is now better than ever! – Adam Sitnik – .NET Performance and Reliability<i>.</i></cite>
Adam Sitnik.
<a href=https://adamsitnik.com/the-new-Memory-Diagnoser/ target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=adamsitnik.com" loading=lazy aria-hidden=true width=16 height=16>
<i>adamsitnik.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jan 2, 2026.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=DotNetGCFundamentals>Fundamentals of garbage collection - .NET | Microsoft Learn<i>.</i></cite>
<a href=https://learn.microsoft.com/en-us/dotnet/standard/garbage-collection/fundamentals target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=learn.microsoft.com" loading=lazy aria-hidden=true width=16 height=16>
<i>learn.microsoft.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jan 2, 2026.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=SitnikEtwProfiler>Profiling .NET Code with BenchmarkDotNet – Adam Sitnik – .NET Performance and Reliability<i>.</i></cite>
Adam Sitnik.
<a href=https://adamsitnik.com/ETW-Profiler/ target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=adamsitnik.com" loading=lazy aria-hidden=true width=16 height=16>
<i>adamsitnik.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jan 2, 2026.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=BenchmarkDotNet.Diagnostics.dotTrace>NuGet Gallery | BenchmarkDotNet.Diagnostics.dotTrace 0.15.8<i>.</i></cite>
<a href=https://www.nuget.org/packages/BenchmarkDotNet.Diagnostics.dotTrace#readme-body-tab target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=www.nuget.org" loading=lazy aria-hidden=true width=16 height=16>
<i>www.nuget.org</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<a href=https://benchmarkdotnet.org/articles/samples/IntroDotTraceDiagnoser.html target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=benchmarkdotnet.org" loading=lazy aria-hidden=true width=16 height=16>
<i>benchmarkdotnet.org</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jan 2, 2026.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=dotnet-trace>dotnet-trace diagnostic tool - .NET CLI - .NET | Microsoft Learn<i>.</i></cite>
<a href=https://learn.microsoft.com/en-us/dotnet/core/diagnostics/dotnet-trace target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=learn.microsoft.com" loading=lazy aria-hidden=true width=16 height=16>
<i>learn.microsoft.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jan 2, 2026.</div></li></ol></article><div style=font-size:smaller><aside id=authors-holder style="margin:0 0 2%">Cited Authors:
<a href=/cited-authors/Sitnik-Adam>Sitnik, Adam</a></aside><aside id=domains-holder style="margin:0 0 2%">Cited Domains:
<a href=/domains/adamsitnik.com style="margin:0 2px"><img src="https://www.google.com/s2/favicons?domain=adamsitnik.com" loading=lazy aria-hidden=true width=16 height=16>
adamsitnik.com</a>
<a href=/domains/benchmarkdotnet.org style="margin:0 2px"><img src="https://www.google.com/s2/favicons?domain=benchmarkdotnet.org" loading=lazy aria-hidden=true width=16 height=16>
benchmarkdotnet.org</a>
<a href=/domains/learn.microsoft.com style="margin:0 2px"><img src="https://www.google.com/s2/favicons?domain=learn.microsoft.com" loading=lazy aria-hidden=true width=16 height=16>
learn.microsoft.com</a>
<a href=/domains/www.nuget.org style="margin:0 2px"><img src="https://www.google.com/s2/favicons?domain=www.nuget.org" loading=lazy aria-hidden=true width=16 height=16>
www.nuget.org</a></aside></div></div><footer><a href=https://www.curiosities.dev/computer-science/programming-challenges/advent-of-code/2024/AoC2024/13-claw-contraption/13-claw-contraption/>&#171; AoC 2024 Day 13: Claw Contraption</a>
<a href=https://www.curiosities.dev/computer-science/programming-challenges/advent-of-code/2024/AoC2024/14-restroom-redoubt/14-restroom-redoubt/>AoC 2024 Day 14: Restroom Redoubt &#187;</a></footer></section></div><footer><a href=/about>About</a>
<a href=/search>Search</a></footer></body></html>