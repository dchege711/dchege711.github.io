<!doctype html><html lang=en><head><title>Spanning 4-Directional Walks From Origin to Destination w/ Obstacles | curiosities.dev</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo (https://gohugo.io/)"><meta name=description content="Problem Given an \(M \times N\) integer array grid where grid[i][j] could be:
 1 representing the starting square. There is exactly one starting square. 2 representing the ending square. There is exactly one ending square. 0 representing empty squares that we can walk over. -1 representing obstacles that we cannot walk over.  Return the number of 4-directional walks from the starting square to the ending square, that walk over every non-obstacle square exactly once...."><meta property="og:title" content="Spanning 4-Directional Walks From Origin to Destination w/ Obstacles"><meta property="og:description" content="Problem Given an \(M \times N\) integer array grid where grid[i][j] could be:
 1 representing the starting square. There is exactly one starting square. 2 representing the ending square. There is exactly one ending square. 0 representing empty squares that we can walk over. -1 representing obstacles that we cannot walk over.  Return the number of 4-directional walks from the starting square to the ending square, that walk over every non-obstacle square exactly once...."><meta property="og:type" content="website"><meta property="og:url" content="https://www.curiosities.dev/computer-science/programming-challenges/leet-code-and-others/grids/4-directional-spanning-walks-with-obstacles/"><meta property="og:site_name" content="curiosities.dev"><link rel=stylesheet type=text/css href=/css/main.min.css><link rel=preload href=/css/all_font_awesome_v5.9.min.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/all_font_awesome_v5.9.min.min.css></noscript><link rel="shortcut icon" href=/img/favicon_io/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/img/favicon_io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon_io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon_io/favicon-16x16.png><script async type=text/javascript src=/js/OrganizeCitations.min.js></script><script async type=text/javascript src=/js/HighlightAnchor.min.js></script><script async type=text/javascript src=/js/SummaryPageUtils.min.js></script><link rel=preload href=/css/vs.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/vs.min.css></noscript><script defer type=text/javascript src=/js/highlight.min.min.js onload=addURLHighlighter();></script><script defer>const hjlsURLRegex=/https?:\/\/[^\s<]+/g
const hjlsCitationRegex=/&lt;span class=&quot;citation-ref&quot;&gt;&lt;a href=&quot;(.*)&quot;&gt;&lt;\/a&gt;&lt;\/span&gt;/g
function addURLHighlighter(){hljs.addPlugin({"after:highlight":(result)=>{result.value=result.value.replaceAll(hjlsURLRegex,"<a href='$&' target='_blank'>$&</a>");console.log(result.value);result.value=result.value.replaceAll(hjlsCitationRegex,"<span class='citation-ref'><a href='$1'></a></span>");}});hljs.highlightAll();}</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body><div class=container id=main_div><form action=/search method=get id=globalSearchForm><input type=text id=q name=q title="Search Query">
<input type=submit id=submitButton value=Search></form><nav aria-label=Breadcrumb class=breadcrumb><ul><li><a href=https://www.curiosities.dev/>Home</a></li><li><a href=https://www.curiosities.dev/computer-science/>Computer Science & Software Engineering</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/>Programming Challenges</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/leet-code-and-others/>Leet Code Style Questions</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/leet-code-and-others/grids/>Grids</a></li><li class=active><a href=https://www.curiosities.dev/computer-science/programming-challenges/leet-code-and-others/grids/4-directional-spanning-walks-with-obstacles/>Spanning 4-Directional Walks From Origin to Destination w/ Obstacles</a></li></ul></nav><section><header><h1>Spanning 4-Directional Walks From Origin to Destination w/ Obstacles</h1><p class=meta>Dated Jul 31, 2022;
last modified on Sun, 31 Jul 2022</p></header><div id=toc-then-article><aside id=toc><nav id=TableOfContents><ul><li><a href=#problem>Problem</a></li><li><a href=#solution>Solution</a></li><li><a href=#references>References</a></li></ul></nav></aside><article id=main-article><h2 id=problem>Problem</h2><p>Given an \(M \times N\) integer array <code>grid</code> where <code>grid[i][j]</code> could
be:</p><ul><li><code>1</code> representing the starting square. There is exactly one starting
square.</li><li><code>2</code> representing the ending square. There is exactly one ending
square.</li><li><code>0</code> representing empty squares that we can walk over.</li><li><code>-1</code> representing obstacles that we cannot walk over.</li></ul><p>Return the number of 4-directional walks from the starting square to the
ending square, that walk over every non-obstacle square exactly once.</p><h2 id=solution>Solution</h2><p>DP no longer seems appropriate for this question because we&rsquo;d need to
store a lot of information at every cell. Furthermore, given that we can
move in any of the four directions, it&rsquo;s not clear what the DP relation
(e.g. <code>grid[r][c] ?= grid[r-1][c-1] + ... + grid[r+1][c+1]</code>) applies.</p><p>Of the path traversals in a grid, depth-first-search seems like a better
fit because we can &ldquo;cache&rdquo; results through the call stack. The longest
possible path is \(MN \le 20\), so we&rsquo;ll not run into a call stack
overflow.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-py data-lang=py><span style=color:#00a8c8>def</span> <span style=color:#75af00>uniquePathsIII</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#111>,</span> <span style=color:#111>grid</span><span style=color:#111>:</span> <span style=color:#111>List</span><span style=color:#111>[</span><span style=color:#111>List</span><span style=color:#111>[</span><span style=color:#111>int</span><span style=color:#111>]])</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>int</span><span style=color:#111>:</span>
  <span style=color:#111>visited</span> <span style=color:#f92672>=</span> <span style=color:#111>[[</span><span style=color:#111>False</span><span style=color:#111>]</span> <span style=color:#f92672>*</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>l</span><span style=color:#111>)</span> <span style=color:#00a8c8>for</span> <span style=color:#111>l</span> <span style=color:#f92672>in</span> <span style=color:#111>grid</span><span style=color:#111>]</span>
  <span style=color:#111>M</span> <span style=color:#f92672>=</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>grid</span><span style=color:#111>)</span>
  <span style=color:#111>N</span> <span style=color:#f92672>=</span> <span style=color:#111>len</span><span style=color:#111>(</span><span style=color:#111>grid</span><span style=color:#111>[</span><span style=color:#ae81ff>0</span><span style=color:#111>])</span>

  <span style=color:#75715e># Find the starting location, and the number of obstacles</span>
  <span style=color:#111>r_origin</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#111>inf</span>
  <span style=color:#111>c_origin</span> <span style=color:#f92672>=</span> <span style=color:#f92672>-</span><span style=color:#111>inf</span>
  <span style=color:#111>num_obstacles</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
  <span style=color:#00a8c8>for</span> <span style=color:#111>r</span> <span style=color:#f92672>in</span> <span style=color:#111>range</span><span style=color:#111>(</span><span style=color:#111>M</span><span style=color:#111>):</span>
    <span style=color:#00a8c8>for</span> <span style=color:#111>c</span> <span style=color:#f92672>in</span> <span style=color:#111>range</span><span style=color:#111>(</span><span style=color:#111>N</span><span style=color:#111>):</span>
      <span style=color:#00a8c8>if</span> <span style=color:#111>grid</span><span style=color:#111>[</span><span style=color:#111>r</span><span style=color:#111>][</span><span style=color:#111>c</span><span style=color:#111>]</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span><span style=color:#111>:</span>
        <span style=color:#111>r_origin</span> <span style=color:#f92672>=</span> <span style=color:#111>r</span>
        <span style=color:#111>c_origin</span> <span style=color:#f92672>=</span> <span style=color:#111>c</span>
      <span style=color:#00a8c8>elif</span> <span style=color:#111>grid</span><span style=color:#111>[</span><span style=color:#111>r</span><span style=color:#111>][</span><span style=color:#111>c</span><span style=color:#111>]</span> <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>:</span>
        <span style=color:#111>num_obstacles</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>

  <span style=color:#111>num_non_obstacles</span> <span style=color:#f92672>=</span> <span style=color:#111>(</span><span style=color:#111>M</span> <span style=color:#f92672>*</span> <span style=color:#111>N</span><span style=color:#111>)</span> <span style=color:#f92672>-</span> <span style=color:#111>num_obstacles</span>

  <span style=color:#75715e># Starting from grid[r][c], do a DFS counting complete spanning paths.</span>
  <span style=color:#00a8c8>def</span> <span style=color:#75af00>dfs</span><span style=color:#111>(</span><span style=color:#111>r</span><span style=color:#111>:</span> <span style=color:#111>int</span><span style=color:#111>,</span> <span style=color:#111>c</span><span style=color:#111>:</span> <span style=color:#111>int</span><span style=color:#111>,</span> <span style=color:#111>num_visited</span><span style=color:#111>:</span> <span style=color:#111>int</span><span style=color:#111>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#111>int</span><span style=color:#111>:</span>
    <span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#111>grid</span><span style=color:#111>[</span><span style=color:#111>r</span><span style=color:#111>][</span><span style=color:#111>c</span><span style=color:#111>]</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>2</span><span style=color:#111>):</span>
      <span style=color:#00a8c8>return</span> <span style=color:#ae81ff>1</span> <span style=color:#00a8c8>if</span> <span style=color:#111>num_visited</span> <span style=color:#f92672>==</span> <span style=color:#111>num_non_obstacles</span> <span style=color:#00a8c8>else</span> <span style=color:#ae81ff>0</span>

    <span style=color:#111>num_complete_trips</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
    <span style=color:#00a8c8>for</span> <span style=color:#111>delta</span> <span style=color:#f92672>in</span> <span style=color:#111>[(</span><span style=color:#ae81ff>0</span><span style=color:#111>,</span> <span style=color:#ae81ff>1</span><span style=color:#111>),</span> <span style=color:#111>(</span><span style=color:#ae81ff>0</span><span style=color:#111>,</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>),</span> <span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#111>,</span> <span style=color:#ae81ff>0</span><span style=color:#111>),</span> <span style=color:#111>(</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>,</span> <span style=color:#ae81ff>0</span><span style=color:#111>)]:</span>
      <span style=color:#111>new_r</span> <span style=color:#f92672>=</span> <span style=color:#111>r</span> <span style=color:#f92672>+</span> <span style=color:#111>delta</span><span style=color:#111>[</span><span style=color:#ae81ff>0</span><span style=color:#111>]</span>
      <span style=color:#111>new_c</span> <span style=color:#f92672>=</span> <span style=color:#111>c</span> <span style=color:#f92672>+</span> <span style=color:#111>delta</span><span style=color:#111>[</span><span style=color:#ae81ff>1</span><span style=color:#111>]</span>
      <span style=color:#111>is_valid_idx</span> <span style=color:#f92672>=</span> <span style=color:#111>new_r</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> <span style=color:#111>new_r</span> <span style=color:#f92672>&lt;</span> <span style=color:#111>M</span> <span style=color:#f92672>and</span> <span style=color:#111>new_c</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>and</span> <span style=color:#111>new_c</span> <span style=color:#f92672>&lt;</span> <span style=color:#111>N</span>
      <span style=color:#00a8c8>if</span> <span style=color:#111>is_valid_idx</span> <span style=color:#f92672>and</span> <span style=color:#f92672>not</span> <span style=color:#111>visited</span><span style=color:#111>[</span><span style=color:#111>new_r</span><span style=color:#111>][</span><span style=color:#111>new_c</span><span style=color:#111>]:</span>
        <span style=color:#00a8c8>if</span> <span style=color:#111>grid</span><span style=color:#111>[</span><span style=color:#111>new_r</span><span style=color:#111>][</span><span style=color:#111>new_c</span><span style=color:#111>]</span> <span style=color:#f92672>!=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span><span style=color:#111>:</span>
          <span style=color:#111>visited</span><span style=color:#111>[</span><span style=color:#111>new_r</span><span style=color:#111>][</span><span style=color:#111>new_c</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>True</span>
          <span style=color:#111>num_complete_trips</span> <span style=color:#f92672>+=</span> <span style=color:#111>dfs</span><span style=color:#111>(</span><span style=color:#111>new_r</span><span style=color:#111>,</span> <span style=color:#111>new_c</span><span style=color:#111>,</span> <span style=color:#111>num_visited</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#111>)</span>
          <span style=color:#111>visited</span><span style=color:#111>[</span><span style=color:#111>new_r</span><span style=color:#111>][</span><span style=color:#111>new_c</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>False</span>

    <span style=color:#00a8c8>return</span> <span style=color:#111>num_complete_trips</span>

  <span style=color:#111>visited</span><span style=color:#111>[</span><span style=color:#111>r_origin</span><span style=color:#111>][</span><span style=color:#111>c_origin</span><span style=color:#111>]</span> <span style=color:#f92672>=</span> <span style=color:#111>True</span>
  <span style=color:#00a8c8>return</span> <span style=color:#111>dfs</span><span style=color:#111>(</span><span style=color:#111>r_origin</span><span style=color:#111>,</span> <span style=color:#111>c_origin</span><span style=color:#111>,</span> <span style=color:#ae81ff>1</span><span style=color:#111>)</span>
</code></pre></div><p><span class=tag-ref><a href=/tags/depth-first-search>#depth-first-search</a></span></p><p><span class=tag-ref><a href=/tags/backtracking>#backtracking</a></span></p><div class=comment-holder><div class=comment><p>The fact that when we reach an invalid path, we discard the path and try
out other options makes this problem a backtracking problem.</p></div></div><p>The running time of DFS is \(O(V + E)\), and given that \(V = MN\)
and \(E \le 4 \cdot MN\), the overall runtime is \(O(MN)\).
Computing <code>r_origin</code>, <code>c_origin</code> and <code>num_obstacles</code> is also
\(O(MN)\). So the overall runtime is still \(O(MN)\). I doubt we can
do better than DFS. On <span class=citation-ref><a href=#LCUniquePathsIII></a></span>&rsquo;s leaderboard, the
above solution is faster than 69% of the submissions.</p><p>The space usage is \(O(MN)\) for the <code>visited</code> array. I prefer not to
modify the incoming <code>grid</code>. On <span class=citation-ref><a href=#LCUniquePathsIII></a></span>&rsquo;s
leaderboard, the above solution uses less memory than 94% of the
submissions. The fact that \(MN \le 20\) allows us to optimize space
usage further by using a bit-mask. <span class=citation-ref><a href=#Archit91LCUniquePathsIII></a></span></p><div class=comment-holder><div class=comment><p>With Python&rsquo;s infinite arithmetic precision, we could presumably use
bit-masking for any \(MN\), instead of only using it for \(MN \le
64\).</p></div></div><div class=comment-holder><div class=comment><p>C++&rsquo;s <code>std::bitset</code> needs to have its number of bits specified at
compile time. For a variable number of bits, <code>std::vector&lt;bool></code> is
recommended. <span class=citation-ref><a href=#cppReferenceBitset></a></span>In this case though, a
<code>std::bitset&lt;20> visited</code> is sufficient.</p></div></div><h2 id=references>References</h2><ol><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=LCUniquePathsIII>Unique Paths III (Hard) - LeetCode<i>.</i></cite>
<a href=https://leetcode.com/problems/unique-paths-iii/submissions/ target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=leetcode.com" loading=lazy aria-hidden=true width=16 height=16>
<i>leetcode.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<a href=https://leetcode.com/submissions/detail/762026448/ target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=leetcode.com" loading=lazy aria-hidden=true width=16 height=16>
<i>leetcode.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jul 31, 2022.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=Archit91LCUniquePathsIII>✅ [C++] DFS + Backtracking + Bit Manipulation | Short & Simple w/ Explanation | Beats 100% - LeetCode Discuss<i>.</i></cite>
<a href=https://leetcode.com/problems/unique-paths-iii/discuss/1554054/C%2B%2B-DFS-%2B-Backtracking-%2B-Bit-Manipulation-or-Short-and-Simple-w-Explanation-or-Beats-100 target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=leetcode.com" loading=lazy aria-hidden=true width=16 height=16>
<i>leetcode.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Jul 31, 2022.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=cppReferenceBitset>std::bitset&lt;N>::bitset - cppreference.com<i>.</i></cite>
<a href=https://en.cppreference.com/w/cpp/utility/bitset/bitset target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=en.cppreference.com" loading=lazy aria-hidden=true width=16 height=16>
<i>en.cppreference.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Aug 2, 2022.</div></li></ol></article><div style=font-size:smaller><aside id=tags-holder style="margin:0 0 2%">Tags:
<a href=/tags/backtracking>#backtracking</a>
<a href=/tags/depth-first-search>#depth-first-search</a></aside><aside id=domains-holder style="margin:0 0 2%">Cited Domains:
<a href=/domains/en.cppreference.com style="margin:0 2px"><img src="https://www.google.com/s2/favicons?domain=en.cppreference.com" loading=lazy aria-hidden=true width=16 height=16>
en.cppreference.com</a>
<a href=/domains/leetcode.com style="margin:0 2px"><img src="https://www.google.com/s2/favicons?domain=leetcode.com" loading=lazy aria-hidden=true width=16 height=16>
leetcode.com</a></aside></div></div><footer><a href=https://www.curiosities.dev/computer-science/programming-challenges/leet-code-and-others/grids/unique-down-right-paths/>&#171; Unique Paths to the Bottom-Right Corner</a>
<a href=https://www.curiosities.dev/computer-science/programming-challenges/leet-code-and-others/grids/unique-down-right-paths-with-obstacles/>Unique Paths to the Bottom-Right Corner w/ Obstacles &#187;</a></footer></section></div><footer><a href=mailto:d.chege711@gmail.com>Email</a>
<a href=/about>About</a>
<a href=/search>Search</a></footer></body></html>