<!doctype html><html lang=en><head><title>The Cards Manager | curiosities.dev</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo (https://gohugo.io/)"><meta name=description content="UI Design   Legacy card viewing UI at /browse.
  This time we&rsquo;ll use the more semantic and a11y-friendly <dialog> element . Centering it in the page is done by the browser, and that saves us a bit of hassle &ndash; thought it would have been feasible with how <search-bar>&rsquo;s <ul> floats above the page.
CardsManager Interface The previous/next buttons make use of the CardsManager object that has the API:..."><link rel=stylesheet type=text/css href=/css/main.min.css><link rel=preload href=/css/all_font_awesome_v5.9.min.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/all_font_awesome_v5.9.min.min.css></noscript><link rel="shortcut icon" href=/img/favicon_io/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/img/favicon_io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon_io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon_io/favicon-16x16.png><script async type=text/javascript src=/js/OrganizeCitations.min.js></script><script async type=text/javascript src=/js/HighlightAnchor.min.js></script><script async type=text/javascript src=/js/SummaryPageUtils.min.js></script><link rel=preload href=/css/vs.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/vs.min.css></noscript><script defer type=text/javascript src=/js/highlight.min.min.js onload=addURLHighlighter();></script><script defer>const hjlsURLRegex=/https?:\/\/[^\s<]+/g
const hjlsCitationRegex=/&lt;span class=&quot;citation-ref&quot;&gt;&lt;a href=&quot;(.*)&quot;&gt;&lt;\/a&gt;&lt;\/span&gt;/g
function addURLHighlighter(){hljs.addPlugin({"after:highlight":(result)=>{result.value=result.value.replaceAll(hjlsURLRegex,"<a href='$&' target='_blank'>$&</a>");console.log(result.value);result.value=result.value.replaceAll(hjlsCitationRegex,"<span class='citation-ref'><a href='$1'></a></span>");}});hljs.highlightAll();}</script></head><body><div class=container id=main_div><form action=/search method=get id=globalSearchForm><input type=text id=q name=q title="Search Query">
<input type=submit id=submitButton value=Search></form><nav aria-label=Breadcrumb class=breadcrumb><ul><li><a href=https://www.curiosities.dev/>Home</a></li><li><a href=https://www.curiosities.dev/computer-science/>Computer Science & Software Engineering</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/>Programming Challenges</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/flashcards-app/>Flashcards App</a></li><li><a href=https://www.curiosities.dev/computer-science/programming-challenges/flashcards-app/web-components/>Using Web Components</a></li><li class=active><a href=https://www.curiosities.dev/computer-science/programming-challenges/flashcards-app/web-components/cards-manager/>The Cards Manager</a></li></ul></nav><section><header><h1>The Cards Manager</h1><p class=meta>Dated Apr 28, 2024;
last modified on Sun, 28 Apr 2024</p></header><div id=toc-then-article><aside id=toc><nav id=TableOfContents><ul><li><a href=#ui-design>UI Design</a></li><li><a href=#cardsmanager-interface><code>CardsManager</code> Interface</a></li><li><a href=#references>References</a></li></ul></nav></aside><article id=main-article><h2 id=ui-design>UI Design</h2><figure><img src=/img/computer-science/programming-challenges/flashcards/web-components/browse-card-viewer.jpg alt="Legacy card viewing UI at /browse."><figcaption><p>Legacy card viewing UI at /browse.</p></figcaption></figure><p>This time we&rsquo;ll use the more semantic and a11y-friendly <code>&lt;dialog></code>
element <span class=citation-ref><a href=#dialogMDN></a></span>. Centering it in the page is done by the
browser, and that saves us a bit of hassle &ndash; thought it would have been
feasible with how <code>&lt;search-bar></code>&rsquo;s <code>&lt;ul></code> floats above the page.</p><h2 id=cardsmanager-interface><code>CardsManager</code> Interface</h2><p>The previous/next buttons make use of the <code>CardsManager</code> object that has
the API:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=color:#00a8c8>interface</span> <span style=color:#75af00>MiniCard</span> <span style=color:#111>{</span> <span style=color:#75af00>_id</span>: <span style=color:#00a8c8>string</span><span style=color:#111>;</span> <span style=color:#75af00>urgency</span>: <span style=color:#00a8c8>number</span><span style=color:#111>,</span> <span style=color:#75af00>tags</span>: <span style=color:#00a8c8>string</span><span style=color:#111>[]</span> <span style=color:#111>}</span>
<span style=color:#00a8c8>interface</span> <span style=color:#75af00>TagsAndIds</span> <span style=color:#111>{</span> <span style=color:#111>[</span><span style=color:#75af00>tag</span>: <span style=color:#00a8c8>string</span><span style=color:#111>]</span><span style=color:#f92672>:</span> <span style=color:#111>{</span> <span style=color:#111>[</span><span style=color:#75af00>id</span>: <span style=color:#00a8c8>string</span><span style=color:#111>]</span><span style=color:#f92672>:</span> <span style=color:#111>{</span> <span style=color:#75af00>urgency</span>: <span style=color:#00a8c8>number</span> <span style=color:#111>}}</span> <span style=color:#111>}</span>

<span style=color:#00a8c8>class</span> <span style=color:#75af00>CardsManager</span> <span style=color:#111>{</span>
  <span style=color:#00a8c8>constructor</span><span style=color:#111>(</span><span style=color:#75af00>tagsAndIds</span>: <span style=color:#00a8c8>TagsAndIds</span><span style=color:#111>,</span> <span style=color:#75af00>userID</span>: <span style=color:#00a8c8>string</span><span style=color:#111>,</span> <span style=color:#75af00>cardSourceURL</span><span style=color:#f92672>=</span><span style=color:#d88200>&#34;/read-card&#34;</span><span style=color:#111>,</span> <span style=color:#75af00>minicards</span>: <span style=color:#00a8c8>MiniCard</span><span style=color:#111>[]</span> <span style=color:#f92672>=</span> <span style=color:#111>[]);</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>initializeFromTags</span><span style=color:#111>(</span><span style=color:#75af00>tagsToUse</span>: <span style=color:#00a8c8>Set</span><span style=color:#111>&lt;</span><span style=color:#f92672>string</span><span style=color:#111>&gt;</span> <span style=color:#f92672>|</span> <span style=color:#00a8c8>null</span><span style=color:#111>)</span><span style=color:#f92672>:</span> <span style=color:#75af00>Promise</span><span style=color:#111>&lt;</span><span style=color:#f92672>void</span><span style=color:#111>&gt;;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>initializeFromMinicards</span><span style=color:#111>(</span><span style=color:#75af00>minicards</span>: <span style=color:#00a8c8>MiniCard</span><span style=color:#111>[],</span> <span style=color:#75af00>includeTagNeighbors</span><span style=color:#f92672>=</span><span style=color:#00a8c8>false</span><span style=color:#111>)</span><span style=color:#f92672>:</span> <span style=color:#75af00>Promise</span><span style=color:#111>&lt;</span><span style=color:#f92672>void</span><span style=color:#111>&gt;;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>initializeFromTrash</span><span style=color:#111>(</span><span style=color:#75af00>cardIds</span>: <span style=color:#00a8c8>string</span><span style=color:#111>[])</span><span style=color:#f92672>:</span> <span style=color:#75af00>Promise</span><span style=color:#111>&lt;</span><span style=color:#f92672>void</span><span style=color:#111>&gt;;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>fetchCard</span><span style=color:#111>(</span><span style=color:#75af00>cardId</span>: <span style=color:#00a8c8>string</span><span style=color:#111>)</span><span style=color:#f92672>:</span> <span style=color:#75af00>Promise</span><span style=color:#111>&lt;</span><span style=color:#f92672>Card</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#75af00>null</span><span style=color:#111>&gt;;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>next</span><span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#75af00>Promise</span><span style=color:#111>&lt;</span><span style=color:#f92672>Card</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#75af00>null</span><span style=color:#111>&gt;;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>hasNext</span><span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#111>Boolean</span><span style=color:#111>;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>previous</span><span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#75af00>Promise</span><span style=color:#111>&lt;</span><span style=color:#f92672>Card</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#75af00>null</span><span style=color:#111>&gt;;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>hasPrevious</span><span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#111>Boolean</span><span style=color:#111>;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>removeCard</span><span style=color:#111>(</span><span style=color:#75af00>cardId</span>: <span style=color:#00a8c8>string</span><span style=color:#111>)</span><span style=color:#f92672>:</span> <span style=color:#00a8c8>string</span><span style=color:#111>;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>status</span><span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#00a8c8>void</span><span style=color:#111>;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>insertCard</span><span style=color:#111>(</span><span style=color:#75af00>cardId</span>: <span style=color:#00a8c8>string</span><span style=color:#111>,</span> <span style=color:#75af00>urgency</span>: <span style=color:#00a8c8>number</span><span style=color:#111>)</span><span style=color:#f92672>:</span> <span style=color:#00a8c8>void</span><span style=color:#111>;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>updateCard</span><span style=color:#111>(</span><span style=color:#75af00>card</span>: <span style=color:#00a8c8>Card</span><span style=color:#111>)</span><span style=color:#f92672>:</span> <span style=color:#00a8c8>void</span><span style=color:#111>;</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>quartiles</span><span style=color:#111>()</span><span style=color:#f92672>:</span> <span style=color:#111>[</span><span style=color:#00a8c8>number</span><span style=color:#111>,</span> <span style=color:#00a8c8>number</span><span style=color:#111>,</span> <span style=color:#00a8c8>number</span><span style=color:#111>,</span> <span style=color:#00a8c8>number</span><span style=color:#111>,</span> <span style=color:#00a8c8>number</span><span style=color:#111>];</span>
  <span style=color:#00a8c8>function</span> <span style=color:#75af00>saveCard</span><span style=color:#111>(</span><span style=color:#75af00>card</span>: <span style=color:#00a8c8>Card</span><span style=color:#111>,</span> <span style=color:#75af00>url</span>: <span style=color:#00a8c8>string</span><span style=color:#111>);</span>
<span style=color:#111>}</span>
</code></pre></div><p>Internally, the <code>CardsManager</code> uses <span class=citation-ref><a href=#avlW8R></a></span>&rsquo;s AVL tree which
is available both in a Node and in a browser environment.</p><p>At its core, the <code>CardsManager</code> maintains the queue of cards that are
accessible using the previous and next buttons. The card itself is
responsible for actions like persisting its content on the server. We
can use the &ldquo;events go up; properties come down&rdquo; design principle to
have a card announce changes in its content, and the <code>CardsManager</code> can
listen for such updates and updates its state accordingly.</p><p>The <code>CardsManager</code> should therefore be at the top-level web component.
It can be availed via <code>Context</code> to descendants that need it, e.g., the
previous and next buttons.</p><p>Having 4 ways of initializing a <code>CardsManager</code> seems excessive. The
current initialization paths are used as:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=color:#75715e>// Browse page
</span><span style=color:#75715e></span><span style=color:#75af00>cardsManager</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>CardsManager</span><span style=color:#111>(</span><span style=color:#75af00>tagsAndIDs</span><span style=color:#111>,</span> <span style=color:#75af00>publicUserID</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;/read-public-card&#39;</span><span style=color:#111>);</span>
<span style=color:#75af00>cardsManager</span><span style=color:#111>.</span><span style=color:#75af00>initializeFromMinicards</span><span style=color:#111>([{</span> <span style=color:#75af00>_id</span>: <span style=color:#00a8c8>cardIdToShow</span><span style=color:#111>,</span> <span style=color:#75af00>urgency</span><span style=color:#111>,</span> <span style=color:#75af00>tags</span><span style=color:#111>}],</span> <span style=color:#75af00>includeTagNeighbors</span><span style=color:#f92672>=</span><span style=color:#00a8c8>true</span><span style=color:#111>);</span>

<span style=color:#75715e>// Home
</span><span style=color:#75715e></span><span style=color:#75af00>cardsManager</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>CardsManager</span><span style=color:#111>(</span><span style=color:#75af00>tagsAndIDs</span><span style=color:#111>,</span> <span style=color:#75af00>currentUserID</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;/read-card&#39;</span><span style=color:#111>,</span> <span style=color:#75af00>mini_cards</span><span style=color:#111>);</span>
<span style=color:#75af00>cardsManager</span><span style=color:#111>.</span><span style=color:#75af00>initializeFromTags</span><span style=color:#111>(</span><span style=color:#75af00>selectedTags</span> <span style=color:#f92672>||</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>Set</span><span style=color:#111>([]));</span>
<span style=color:#75af00>cardsManager</span><span style=color:#111>.</span><span style=color:#75af00>initializeFromMinicards</span><span style=color:#111>([</span><span style=color:#75af00>clickedSearchResult</span><span style=color:#111>]);</span>

<span style=color:#75715e>// Account page
</span><span style=color:#75715e></span><span style=color:#75af00>cardsManager</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>CardsManager</span><span style=color:#111>(</span><span style=color:#75af00>metadata</span><span style=color:#111>.</span><span style=color:#75af00>node_information</span><span style=color:#111>[</span><span style=color:#ae81ff>0</span><span style=color:#111>],</span> <span style=color:#75af00>currentUserID</span><span style=color:#111>);</span>
<span style=color:#75af00>cardsManager</span><span style=color:#111>.</span><span style=color:#75af00>initializeFromTrash</span><span style=color:#111>(</span><span style=color:#75af00>state</span><span style=color:#111>.</span><span style=color:#75af00>metadata</span><span style=color:#111>.</span><span style=color:#75af00>trashed_cards</span><span style=color:#111>[</span><span style=color:#ae81ff>0</span><span style=color:#111>]);</span>
</code></pre></div><p>The fact that
<a href=https://www.curiosities.dev/computer-science/programming-challenges/flashcards-app/client-server-interface/#typing-the-clientserver-interface target=_blank rel=noopener>we&rsquo;re using tRPC
<i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>means that we can replace <code>cardSourceURL</code> with
<code>cardSearchEndpoint</code>. <code>CardsManager</code> queries the endpoint in
<code>fetchCard</code>, <code>next</code>, <code>previous</code>, and <code>status</code>. However, this is not
strictly needed. For instance, in the web-component based <code>/browse</code>, the
<code>&lt;browse-page></code> component queries the endpoint in response to a
<code>search-result-selected</code> message. Similarly, the next/previous buttons
can fire this event, and have the <code>&lt;browse-page></code> load the appropriate
card, and pass it as a property to the <code>public-card-viewer</code>.</p><p>The <code>userId</code> parameter is also not needed. The endpoints themselves
enforce the appropriate user ID, e.g., <code>fetchCard</code> enforces the ID that
is in the session object.</p><p><code>CardsManager.initializeFromTags</code> is not needed anymore, given that we
are doing away with the tags bar on the left. Selecting cards that match
a given tag will be done via the search box, which will bubble up the
<code>CardSearchResult[]</code> via the <code>search-results</code> event to the
<code>searchResultsContext</code>.</p><p><code>CardsManager.initializeFromMinicards</code> is a weird one. <code>/home</code> passes
<code>includeTagNeighbors=false</code>, the <code>CardsManager</code> only has 1 card in the
queue, which is somewhat less useful. That said, this case is still
covered by the <code>search-results</code> event. <code>/browse</code> passes
<code>includeTagNeighbors=true</code>, which makes the <code>CardsManager</code> also add
cards that share a tag with the card that is being shown based on the
<code>TagsAndIds</code> passed in the ctor. This can be computed instead by
<code>&lt;browse-page></code> and passed in <code>CardsManager</code>&rsquo;s ctor as a <code>MiniCard[]</code>.</p><p><code>CardsManager.initializeFromTrash</code> should be removed from <code>/account</code> and
in its place, the user can access deleted cards from <code>&lt;search-results></code>.</p><p>With the above changes, <code>CardsManager</code> can be initialized through the
simpler <code>constructor(miniCards: MiniCard[])</code> that also captures that
<code>CardsManager</code> deals with the set of cards that the user can see. It
would also be beneficial to rename the class to something
<code>CardsCarousel</code> instead of the <code>CardsManager</code> which promises more
functionality than is provided.</p><h2 id=references>References</h2><ol><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=dialogMDN>`&lt;dialog>`: The Dialog element - HTML: HyperText Markup Language | MDN<i>.</i></cite>
<a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Element/dialog target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=developer.mozilla.org" loading=lazy aria-hidden=true width=16 height=16>
<i>developer.mozilla.org</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Apr 28, 2024.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=avlW8R>w8r/avl: :eyeglasses: Fast AVL tree for Node and browser<i>.</i></cite>
<a href=https://github.com/w8r/avl target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=github.com" loading=lazy aria-hidden=true width=16 height=16>
<i>github.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed Apr 28, 2024.</div></li></ol></article><div style=font-size:smaller></div></div><footer><a href=https://www.curiosities.dev/computer-science/programming-challenges/flashcards-app/web-components/browse-page/>&#171; Browse Page</a>
<a href=https://www.curiosities.dev/computer-science/programming-challenges/flashcards-app/web-components/reusable-cards/>Reusable Cards &#187;</a></footer></section></div><footer><a href=mailto:d.chege711@gmail.com>Email</a>
<a href=/about>About</a>
<a href=/search>Search</a></footer></body></html>