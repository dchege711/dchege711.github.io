<!doctype html><html lang=en><head><title>Query Languages for Data | curiosities.dev</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo (https://gohugo.io/)"><meta name=description content="Query Languages for Data If you have a list of animal species and you want to return only the sharks in the list, a relational algebra expression would be \( \text{sharks} = \sigma_{\text{family = &ldquo;Sharks&rdquo;}}(\text{animals}) \). SQL queries follow the structure of relational algebra closely:
SELECT * FROM animals WHERE family = 'Sharks'; &mldr; while an imperative query would be:
function getSharks() { let sharks = []; for (let i = 0; i < animals...."><link rel=stylesheet type=text/css href=/css/main.min.css><link rel=preload href=/css/all_font_awesome_v5.9.min.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/all_font_awesome_v5.9.min.min.css></noscript><link rel="shortcut icon" href=/img/favicon_io/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/img/favicon_io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon_io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon_io/favicon-16x16.png><script async type=text/javascript src=/js/OrganizeCitations.min.js></script><script async type=text/javascript src=/js/HighlightAnchor.min.js></script><script async type=text/javascript src=/js/SummaryPageUtils.min.js></script><link rel=preload href=/css/vs.min.css as=style onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel=stylesheet href=/css/vs.min.css></noscript><script defer type=text/javascript src=/js/highlight.min.min.js onload=addURLHighlighter();></script><script defer>const hjlsURLRegex=/https?:\/\/[^\s<]+/g
const hjlsCitationRegex=/&lt;span class=&quot;citation-ref&quot;&gt;&lt;a href=&quot;(.*)&quot;&gt;&lt;\/a&gt;&lt;\/span&gt;/g
function addURLHighlighter(){hljs.addPlugin({"after:highlight":(result)=>{result.value=result.value.replaceAll(hjlsURLRegex,"<a href='$&' target='_blank'>$&</a>");console.log(result.value);result.value=result.value.replaceAll(hjlsCitationRegex,"<span class='citation-ref'><a href='$1'></a></span>");}});hljs.highlightAll();}</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script></head><body><div class=container id=main_div><form action=/search method=get id=globalSearchForm><input type=text id=q name=q title="Search Query">
<input type=submit id=submitButton value=Search></form><nav aria-label=Breadcrumb class=breadcrumb><ul><li><a href=https://www.curiosities.dev/>Home</a></li><li><a href=https://www.curiosities.dev/computer-science/>Computer Science & Software Engineering</a></li><li><a href=https://www.curiosities.dev/computer-science/klepmann-ddia/>Designing Data-Intensive Applications [Book]</a></li><li><a href=https://www.curiosities.dev/computer-science/klepmann-ddia/01-foundations-of-data-systems/>Foundations of Data Systems</a></li><li><a href=https://www.curiosities.dev/computer-science/klepmann-ddia/01-foundations-of-data-systems/02-data-models-and-query-languages/>Data Models and Query Languages</a></li><li class=active><a href=https://www.curiosities.dev/computer-science/klepmann-ddia/01-foundations-of-data-systems/02-data-models-and-query-languages/query-languages-for-data/>Query Languages for Data</a></li></ul></nav><section><header><h1>Query Languages for Data</h1><p class=meta>Dated May 29, 2023;
last modified on Mon, 29 May 2023</p></header><div id=toc-then-article><aside id=toc><nav id=TableOfContents><ul><li><a href=#query-languages-for-data>Query Languages for Data</a></li><li><a href=#mapreduce-querying>MapReduce Querying</a></li><li><a href=#references>References</a></li></ul></nav></aside><article id=main-article><h2 id=query-languages-for-data>Query Languages for Data</h2><p>If you have a list of animal species and you want to return only the sharks in
the list, a relational algebra expression would be \( \text{sharks} =
\sigma_{\text{family = &ldquo;Sharks&rdquo;}}(\text{animals}) \). SQL queries follow the
structure of relational algebra closely:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#00a8c8>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#00a8c8>FROM</span> <span style=color:#111>animals</span> <span style=color:#00a8c8>WHERE</span> <span style=color:#111>family</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;Sharks&#39;</span><span style=color:#111>;</span>
</code></pre></div><p>&mldr; while an imperative query would be:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#00a8c8>function</span> <span style=color:#75af00>getSharks</span><span style=color:#111>()</span> <span style=color:#111>{</span>
  <span style=color:#00a8c8>let</span> <span style=color:#75af00>sharks</span> <span style=color:#f92672>=</span> <span style=color:#111>[];</span>
  <span style=color:#00a8c8>for</span> <span style=color:#111>(</span><span style=color:#00a8c8>let</span> <span style=color:#75af00>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span><span style=color:#111>;</span> <span style=color:#75af00>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#75af00>animals</span><span style=color:#111>.</span><span style=color:#75af00>length</span><span style=color:#111>;</span> <span style=color:#75af00>i</span><span style=color:#f92672>++</span><span style=color:#111>)</span> <span style=color:#111>{</span>
    <span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#75af00>animals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>].</span><span style=color:#75af00>family</span> <span style=color:#f92672>===</span> <span style=color:#d88200>&#34;Sharks&#34;</span><span style=color:#111>)</span> <span style=color:#111>{</span>
      <span style=color:#75af00>sharks</span><span style=color:#111>.</span><span style=color:#75af00>push</span><span style=color:#111>(</span><span style=color:#75af00>animals</span><span style=color:#111>[</span><span style=color:#75af00>i</span><span style=color:#111>]);</span>
    <span style=color:#111>}</span>
  <span style=color:#111>}</span>
  <span style=color:#00a8c8>return</span> <span style=color:#75af00>sharks</span><span style=color:#111>;</span>
<span style=color:#111>}</span>
</code></pre></div><p><span class=citation-ref><a href=#Kleppmann2017-Ch2></a></span></p><div class=comment-holder><div class=comment><p>To be fair though, JS&rsquo;s <code>Array.prototype.filter</code> supports more succinct code:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=color:#00a8c8>let</span> <span style=color:#75af00>sharks</span> <span style=color:#f92672>=</span> <span style=color:#75af00>animals</span><span style=color:#111>.</span><span style=color:#75af00>filter</span><span style=color:#111>(</span><span style=color:#75af00>animal</span> <span style=color:#111>=&gt;</span> <span style=color:#75af00>animal</span><span style=color:#111>.</span><span style=color:#75af00>family</span> <span style=color:#f92672>===</span> <span style=color:#d88200>&#34;Sharks&#34;</span><span style=color:#111>);</span>
</code></pre></div><p><span class=citation-ref><a href=#MDNArrayFilter></a></span></p></div></div><p>An imperative language tells the computer to perform certain operations in a
certain order. A declarative language specifies the pattern of the data you
want, but not <em>how</em> to achieve that goal. <span class=citation-ref><a href=#Kleppmann2017-Ch2></a></span></p><div class=comment-holder><div class=comment><p>Ah, so that&rsquo;s what <code>animals.filter(animal => animal.family === "Sharks")</code> is!</p></div></div><p>Advantages of declarative query languages:</p><ul><li>Typically more concise and easier to work with.</li><li>Hides implementation details, and can therefore freely benefit from
improvements in the query optimizer. An imperative query would need to be
rewritten to take advantage of newer and better APIs and/or data layout.</li><li>Lend themselves to parallelization because they do not specify an algorithm.</li></ul><p><span class=citation-ref><a href=#Kleppmann2017-Ch2></a></span></p><h2 id=mapreduce-querying>MapReduce Querying</h2><p><code>MapReduce</code> is somewhere in between a declarative query language and a fully
imperative query API. Suppose you want to generate a report on how many sharks
sighted per month. In PostgreSQL, you&rsquo;d have:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-sql data-lang=sql><span style=color:#00a8c8>SELECT</span> <span style=color:#111>date_trunc</span><span style=color:#111>(</span><span style=color:#d88200>&#39;month&#39;</span><span style=color:#111>,</span> <span style=color:#111>observation_timestamp</span><span style=color:#111>)</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>observation_month</span><span style=color:#111>,</span>
       <span style=color:#00a8c8>sum</span><span style=color:#111>(</span><span style=color:#111>num_animals</span><span style=color:#111>)</span> <span style=color:#00a8c8>AS</span> <span style=color:#111>total_animals</span>
<span style=color:#00a8c8>FROM</span> <span style=color:#111>observations</span>
<span style=color:#00a8c8>WHERE</span> <span style=color:#111>family</span> <span style=color:#f92672>=</span> <span style=color:#d88200>&#39;Sharks&#39;</span>
<span style=color:#00a8c8>GROUP</span> <span style=color:#00a8c8>BY</span> <span style=color:#111>observation_month</span><span style=color:#111>;</span>
</code></pre></div><p>&mldr; but the same can be expressed with MongoDB&rsquo;s <code>MapReduce</code> feature as:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=color:#75af00>db</span><span style=color:#111>.</span><span style=color:#75af00>observations</span><span style=color:#111>.</span><span style=color:#75af00>mapReduce</span><span style=color:#111>(</span>
  <span style=color:#75715e>// Called once for every document that matches `query`, with `this` set to the
</span><span style=color:#75715e></span>  <span style=color:#75715e>// document object.
</span><span style=color:#75715e></span>  <span style=color:#00a8c8>function</span> <span style=color:#75af00>map() {</span>
    <span style=color:#00a8c8>let</span> <span style=color:#75af00>year</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>this</span><span style=color:#111>.</span><span style=color:#75af00>observationTimestamp</span><span style=color:#111>.</span><span style=color:#75af00>getFullYear</span><span style=color:#111>();</span>
    <span style=color:#00a8c8>let</span> <span style=color:#75af00>month</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>this</span><span style=color:#111>.</span><span style=color:#75af00>observationTimestamp</span><span style=color:#111>.</span><span style=color:#75af00>getMonth</span><span style=color:#111>()</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span><span style=color:#111>;</span>
    <span style=color:#75af00>emit</span><span style=color:#111>(</span><span style=color:#d88200>`</span><span style=color:#d88200>${</span><span style=color:#75af00>year</span><span style=color:#d88200>}</span><span style=color:#d88200>-</span><span style=color:#d88200>${</span><span style=color:#75af00>month</span><span style=color:#d88200>}</span><span style=color:#d88200>`</span><span style=color:#111>,</span> <span style=color:#00a8c8>this</span><span style=color:#111>.</span><span style=color:#75af00>numAnimals</span><span style=color:#111>);</span>
  <span style=color:#111>},</span>
  <span style=color:#75715e>// The key-value pairs emitted by map are grouped by key, such that `reduce`
</span><span style=color:#75715e></span>  <span style=color:#75715e>// is called once for every `key`, e.g., `reduce(&#34;2023-2&#34;, [23, 1, 43])`.
</span><span style=color:#75715e></span>  <span style=color:#00a8c8>function</span> <span style=color:#75af00>reduce</span><span style=color:#111>(</span><span style=color:#75af00>key</span>: <span style=color:#00a8c8>string</span><span style=color:#111>,</span> <span style=color:#75af00>values</span>: <span style=color:#00a8c8>numbers</span><span style=color:#111>[])</span> <span style=color:#111>{</span>
    <span style=color:#00a8c8>return</span> <span style=color:#111>Array</span><span style=color:#111>.</span><span style=color:#75af00>sum</span><span style=color:#111>(</span><span style=color:#75af00>values</span><span style=color:#111>);</span>
  <span style=color:#111>},</span>
  <span style=color:#111>{</span>
    <span style=color:#75715e>// A MongoDB-specific extension to MapReduce that allows declarative filters
</span><span style=color:#75715e></span>    <span style=color:#75af00>query</span><span style=color:#f92672>:</span> <span style=color:#111>{</span> <span style=color:#75af00>family</span><span style=color:#f92672>:</span> <span style=color:#d88200>&#34;Sharks&#34;</span> <span style=color:#111>},</span>
    <span style=color:#75715e>// The final output is written to the collection `monthlySharkReport`.
</span><span style=color:#75715e></span>    <span style=color:#75af00>out</span><span style=color:#f92672>:</span> <span style=color:#d88200>&#34;monthlySharkReport&#34;</span>
  <span style=color:#111>}</span>
<span style=color:#111>);</span>
</code></pre></div><p><span class=citation-ref><a href=#Kleppmann2017-Ch2></a></span></p><p><code>map</code> and <code>reduce</code> must be pure functions (only depend on input params and have
no side effects). As such, the DB can run them anywhere in any order, and rerun
them on failure. That said, they are powerful in that they can parse strings,
call library functions, perform calculations, etc., and therefore convenient for
advanced queries. <span class=citation-ref><a href=#Kleppmann2017-Ch2></a></span></p><div class=comment-holder><div class=comment><p>Enforcing that <code>map</code> and <code>reduce</code> be pure functions seems hard to do in JS. For
example, <span class=citation-ref><a href=#MDNArrayFilter></a></span>has a &ldquo;here be dragons&rdquo; warning for impure
implementations of the filter function.</p></div></div><p>However, one has to write two coordinated functions, and the imperativeness
limits the opportunities for a query optimizer to improve the performance of a
query. MongoDB 2.2 thus added a declarative query language called the
<em>aggregation pipeline</em>:</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-ts data-lang=ts><span style=color:#75af00>db</span><span style=color:#111>.</span><span style=color:#75af00>observations</span><span style=color:#111>.</span><span style=color:#75af00>aggregate</span><span style=color:#111>([</span>
  <span style=color:#111>{</span> <span style=color:#75af00>$match</span><span style=color:#f92672>:</span> <span style=color:#111>{</span> <span style=color:#75af00>family</span><span style=color:#f92672>:</span> <span style=color:#d88200>&#34;Sharks&#34;</span> <span style=color:#111>}</span> <span style=color:#111>},</span>
  <span style=color:#111>{</span> <span style=color:#75af00>$group</span><span style=color:#f92672>:</span> <span style=color:#111>{</span>
      <span style=color:#75af00>_id</span><span style=color:#f92672>:</span> <span style=color:#111>{</span>
        <span style=color:#75af00>year</span><span style=color:#f92672>:</span>  <span style=color:#111>{</span> <span style=color:#75af00>$year</span><span style=color:#f92672>:</span>  <span style=color:#d88200>&#34;$observationTimestamp&#34;</span> <span style=color:#111>},</span>
        <span style=color:#75af00>month</span><span style=color:#f92672>:</span> <span style=color:#111>{</span> <span style=color:#75af00>$month</span><span style=color:#f92672>:</span> <span style=color:#d88200>&#34;$observationTimestamp&#34;</span> <span style=color:#111>}</span>
      <span style=color:#111>},</span>
      <span style=color:#75af00>totalAnimals</span><span style=color:#f92672>:</span> <span style=color:#111>{</span> <span style=color:#75af00>$sum</span><span style=color:#f92672>:</span> <span style=color:#d88200>&#34;$numAnimals&#34;</span> <span style=color:#111>}</span>
  <span style=color:#111>}</span> <span style=color:#111>}</span>
<span style=color:#111>]);</span>
</code></pre></div><p><span class=citation-ref><a href=#Kleppmann2017-Ch2></a></span></p><div class=comment-holder><div class=comment><p>MongoDB 5.0 deprecated <code>mapReduce</code> in favor of the aggregation pipeline, citing
better performance and usability. <span class=citation-ref><a href=#MongoDBMapReduce></a></span></p><p>This lends credence to <span class=citation-ref><a href=#Kleppmann2017-Ch2></a></span>&rsquo;s quip that a NoSQL system
may find itself accidentally reinventing SQL, albeit in disguise.</p></div></div><h2 id=references>References</h2><ol><li><div class=citation citation-icon-class cited-by-count is-main><cite id=Kleppmann2017-Ch2>Designing Data-Intensive Applications: The big ideas behind reliable, scalable, and maintainable systems<i>.</i>
Chapter 2: Data Models and Query Languages<i>.</i></cite>
Kleppmann, Martin.
Mar 16, 2017.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=MDNArrayFilter>Array.prototype.filter() - JavaScript | MDN<i>.</i></cite>
<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=developer.mozilla.org" loading=lazy aria-hidden=true width=16 height=16>
<i>developer.mozilla.org</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed May 29, 2023.</div></li><li><div class=citation citation-icon-class="fas fa-fw fa-globe" cited-by-count is-main><cite id=MongoDBMapReduce>Map-Reduce — MongoDB Manual<i>.</i></cite>
<a href=https://www.mongodb.com/docs/manual/core/map-reduce/ target=_blank rel=noopener><img src="https://www.google.com/s2/favicons?domain=www.mongodb.com" loading=lazy aria-hidden=true width=16 height=16>
<i>www.mongodb.com</i> <i class="fas fa-fw fa-external-link-alt" aria-hidden=true></i></a>.
<i class="fas fa-fw fa-globe" aria-hidden=true></i>Accessed May 29, 2023.</div></li></ol></article><div style=font-size:smaller><aside id=authors-holder style="margin:0 0 2%">Cited Authors:
<a href=/cited-authors/Kleppmann-Martin>Kleppmann, Martin</a></aside><aside id=domains-holder style="margin:0 0 2%">Cited Domains:
<a href=/domains/developer.mozilla.org style="margin:0 2px"><img src="https://www.google.com/s2/favicons?domain=developer.mozilla.org" loading=lazy aria-hidden=true width=16 height=16>
developer.mozilla.org</a>
<a href=/domains/www.mongodb.com style="margin:0 2px"><img src="https://www.google.com/s2/favicons?domain=www.mongodb.com" loading=lazy aria-hidden=true width=16 height=16>
www.mongodb.com</a></aside></div></div><footer><a href=https://www.curiosities.dev/computer-science/klepmann-ddia/01-foundations-of-data-systems/02-data-models-and-query-languages/relational-model-vs-document-model/>&#171; Relational Model Versus Document Model</a></footer></section></div><footer><a href=mailto:d.chege711@gmail.com>Email</a>
<a href=/about>About</a>
<a href=/search>Search</a></footer></body></html>